version: '2'

networks:
  monitoring:

services:
  influxdb-cb:
    image: quay.io/influxdb/influxdb:2.0.0-beta
    hostname: influxdb-cb
    container_name: influxdb-cb
    ports:
      - 9999:9999
    volumes:
      - /data/influxdb/cloudberry/data:/var/lib/influxdb # data
      - /data/influxdb/cloudberry/config:/etc/influxdb # configs
    networks:
      - monitoring
    command: --reporting-disabled
    environment:
      INFLUXDB_ADMIN_USER: root
      INFLUXDB_ADMIN_PASSWORD: ziemniak
  telegraf-cb:
    image: telegraf:latest
    hostname: telegraf-cb
    container_name: telegraf-cb
    restart: always
    volumes:
      - ./telegraf.conf:/etc/telegraf/telegraf.conf:ro
    networks:
      - monitoring
    environment:
      USER: root
      TELEGRAF_INFLUX_URL: http://influxdb-cb:9999
      TELEGRAF_INFLUX_ORGANIZATION: "cloudberry"
      TELEGRAF_INFLUX_METRICS_BUCKET: "cloudberry-metrics"
      TELEGRAF_INFLUX_TOKEN: m8m8olbdS7PQUNf4MxK7BOvIjG01iGe7FyoP0RXcHNeQXA9xeV2Lo9fr2qXxhrFuyvKNo8D4jqhLyPgZ9Q7Q2Q==
